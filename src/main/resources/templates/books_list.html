<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>图书列表</title>
		<link type="text/css" rel="stylesheet" href="dist/css/bootstrap.min.css" th:href="@{/dist/css/bootstrap.min.css}" >
		<link rel="stylesheet" type="text/css" href="css/index.css" th:href="@{/css/index.css}" />
		<link rel="stylesheet" type="text/css" href="css/animate.css" th:href="@{/css/animate.css}" />
	
	</head>
	<body>
		<!--导航部分  begin-->
		<div class="container" style="margin-top: 5px;">
			<nav class="navbar navbar-default well-sm" style="padding-left: 0px;" role="navigation">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
							<span class="sr-only">切换导航</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">SOM书城</a>
					</div>
					<div class="collapse navbar-collapse" id="example-navbar-collapse">
						<ul class="nav navbar-nav pull-left">
							<li class="active">
								<a href="index.html" th:href="@{/book/index}">首页</a>
							</li>

							<li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									图书类型
									<b class="caret"></b>
								</a>
								<ul class="dropdown-menu">
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=1)}" >精选图书</a>
									</li>
									<li class="divider"></li>
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=2)}" >推荐图书</a>
									</li>
									<li class="divider"></li>
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=3)}" >特价图书</a>
									</li>
									<li class="divider"></li>
								</ul>
							</li>
							</li>
							<li th:if="${session.user == null}">
								<a href="#" data-toggle="modal" data-target="#login">登录</a>
							</li>
							<li th:if="${session.user != null}">
								<a href="javascript:void(0)" th:text="${'欢迎您，'+ session.user.getUsername()}">用户名</a>
							</li>
							<li th:if="${session.user != null}">
								<a href="index.html" th:href="@{/user/loginOut}">安全退出</a>
							</li>
							<li th:if="${session.user == null}">
								<a href="#" data-toggle="modal" data-target="#register">注册</a>
							</li>
							<li>
								<a href="order_list.html">我的订单</a>
							</li>
							<li>
								<a href="cart.html"><span class="glyphicon glyphicon-shopping-cart"> </span>我的购物车</a>
							</li>
						</ul>
						<div class="input-group col-md-3 pull-right" style="positon:relative;padding: 7px;">
							<input type="text" class="form-control" placeholder="请输入图书名" />
							<span class="input-group-btn">  
					            <button class="btn btn-info btn-search">
					            	<span class="glyphicon glyphicon-search"></span>
					            </button>
							</span>
						</div>
					</div>
				</div>
			</nav>
		</div>
		<!--导航部分 end-->
		<!--最顶端轮播图片 begin-->
		<div id="gcarouse" class="container">
			<!--轮播-->
			<div id="myCarousel" class="carousel slide">
				<!-- 轮播（Carousel）指标 -->
				<ol class="carousel-indicators">
					<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					<li data-target="#myCarousel" data-slide-to="1"></li>
					<li data-target="#myCarousel" data-slide-to="2"></li>
				</ol>
				<!-- 轮播（Carousel）项目 -->
				<div class="carousel-inner">
								<div class="item active">
						<a href="details.html"><img src="images/advert1.jpg" th:src="@{/images/advert1.jpg}" class="pull-left" alt="First slide"></a>
					
					</div>
					<div class="item">
						<a href="details.html"><img src="images/advert2.jpg" th:src="@{/images/advert2.jpg}"  class="pull-left" alt="First slide"></a>
						
					</div>
					<div class="item">
						<a href="details.html"><img src="images/advert3.jpg" th:src="@{/images/advert3.jpg}"  class="pull-left" alt="First slide"></a>
					
					</div>
				</div>

				<!-- 轮播（Carousel）导航 -->
				<a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
				<a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
			</div>
		</div>
		<!--最顶端轮播图片 end-->
		<div class="container">	
			<ol class="breadcrumb">
			    <li><a href="#">图书列表</a></li>
			    <li><a href="#">精选图书</a></li>
			</ol>
		</div>
		
		<!--展示数据开始 begin-->
		<div id="bookList"></div>
		<!--展示数据结束 end-->

		<!--地址-->
		<div class="container">
		<hr>
			<div class="container">
				<div class="row">
					<div class="col-md-offset-2 col-md-8">
						<div class="row">
							<div class="col-md-offset-2 col-md-2">
								<img src="images/logo.png" th:src="@{/images/logo.png}">
							</div>
							<div class="col-md-6" style="margin-top: 10px;">
								<div class="row">
									<div class="col-md-offset-2 col-md-10">
										<a href="http://www.soulmatelq.top/">SOM集团信息科技有限公司&copy;所有</a>
									</div>
								</div>
								<div class="gap"></div>
								<div class="row">
									<div class="col-md-offset-2 col-md-10">
										<span class="text-info">SOM&reg; |&nbsp;</span>
										<span class="text-info"><a href="http://www.soulmatelq.top">SOM书店</a> |&nbsp;</span>
										<span class="text-info">2019－2020 </span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--end-->
	<script src="dist/js/jquery.min.js" th:src="@{/dist/js/jquery.min.js}"></script>
	<script src="js/carousel.js" th:src="@{/js/carousel.js}" type="text/javascript" charset="utf-8"></script>
	<script src="dist/js/bootstrap.min.js" th:src="@{/dist/js/bootstrap.min.js}"></script>
	<script src="js/wow.js" th:src="@{/js/wow.js}"></script>

	<script th:inline="javascript">
		var contextPath = [[${#request.getContextPath()}]];
		var category = [[${category}]];
		var pSize = [[${pageSize}]]
	</script>
	<script type="text/javascript">
		if(!(/msie [6|7|8|9]/i.test(navigator.userAgent))) {
			new WOW().init();
		};
		$(function () {
			$("#bookList").load(contextPath + "/book/getBookListData",queryData(1,'',category));
        })

		function queryData(page,pageSize, category) {
			var query = {};
			query.category = category;
			query.page = page;
			query.pageSize  = pageSize == ''? 4 : pageSize;
            return query;
        }
		function loadData(page,pageSize,category) {
            $("#bookList").load(contextPath + "/book/getBookListData",queryData(page,pageSize,category));
        }
        
        function goPage(pageSize,category) {
		    var page = $("#inputPage").val();
            $("#bookList").load(contextPath + "/book/getBookListData",queryData(page,pageSize,category));
        }
        function loadDataBySize(obj) {
            $("#bookList").load(contextPath + "/book/getBookListData",queryData(1,obj.value,category));
        }

		//验证用户是否存在
		function  CheckUser(obj) {
			//alert(obj.value);
			$.ajax({
				url:contextPath + "/user/checkUserName",
				data:{"username":obj.value},
				method:"post",
				success:function (data) {
					$("#msg").css("display","block");
					if(data == 102){
						$("#msg").css("display","block");
						$("#tip").html("用户名不合法!");
						$("#tip").removeClass("alert-success");
						$("#tip").addClass("alert-danger");
					}else{
						$("#msg").css("display","block");
						$("#tip").html("用户名可以使用!");
						$("#tip").removeClass("alert-danger");
						$("#tip").addClass("alert-success");
					}
				}
			})
		}
		//用户注册
		function register() {
			var datas = $("#regForm").serialize();
			$.ajax({
				url:contextPath + "/user/register",
				data:datas,
				method:"post",
				success:function (data) {
					if(data == 'success'){
						alert("注册成功,请登录");
						$("#register").modal("hide");
					}
				}
			})
		}

		//用户登录
		function login() {
			var datas = $("#loginForm").serialize();
			$.ajax({
				url: contextPath + "/user/login",
				data:datas,
				method:"post",
				success:function (data) {   //100表示登录成功    101表示用户不存在    102表示密码错误
					$("#userTip").css("display","none");
					$("#pwdTip").css("display","none");
					if(data == 100){
						$("#login").modal("hide");
						//alert("登录成功!");
						//登录成功之后跳转首页
						window.location.href = contextPath + "/book/index";
					}else if(data == 101){
						$("#userTip").css("display","block");

					}else{
						$("#pwdTip").css("display","block");
					}
				}
			})
		}

	</script>
	</body>
</html>
