<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<title>我的购物车</title>
		<link type="text/css" rel="stylesheet" href="dist/css/bootstrap.min.css" th:href="@{/dist/css/bootstrap.min.css}" >
		<link rel="stylesheet" type="text/css" href="css/index.css" th:href="@{/css/index.css}" />
		<link rel="stylesheet" type="text/css" href="css/animate.css" th:href="@{/css/animate.css}" />
		<link rel="stylesheet" type="text/css" href="css/cart.css" th:href="@{/css/cart.css}" />
	</head>

<!--	onload="changeNum()"-->
	<body>
		<!--导航部分  begin-->
		<div class="container" style="margin-top: 5px;">
			<nav class="navbar navbar-default well-sm" style="padding-left: 0px;" role="navigation">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
							<span class="sr-only">切换导航</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">SOM书城</a>
					</div>
					<div class="collapse navbar-collapse" id="example-navbar-collapse">
						<ul class="nav navbar-nav pull-left">
							<li class="active">
								<a href="index.html" th:href="@{/book/index}">首页</a>
							</li>

							<li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									图书类型
									<b class="caret"></b>
								</a>
								<ul class="dropdown-menu">
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=1)}" >精选图书</a>
									</li>
									<li class="divider"></li>
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=2)}" >推荐图书</a>
									</li>
									<li class="divider"></li>
									<li>
										<a href="books_list.html" th:href="@{/book/bookList(category=3)}" >特价图书</a>
									</li>
									<li class="divider"></li>
								</ul>
							</li>
							</li>
							<li th:if="${session.user == null}">
								<a href="#" data-toggle="modal" data-target="#login">登录</a>
							</li>
							<li th:if="${session.user != null}">
								<a href="javascript:void(0)" th:text="${'欢迎您，'+ session.user.getUsername()}">用户名</a>
							</li>
							<li th:if="${session.user != null}">
								<a href="index.html" th:href="@{/user/loginOut}">安全退出</a>
							</li>
							<li th:if="${session.user == null}">
								<a href="#" data-toggle="modal" data-target="#register">注册</a>
							</li>
							<li>
								<a href="order_list.html">我的订单</a>
							</li>
							<li>
								<a href="cart.html" th:href="@{/cart/list}"><span class="glyphicon glyphicon-shopping-cart"> </span>我的购物车</a>
							</li>
						</ul>
						<div class="input-group col-md-3 pull-right" style="positon:relative;padding: 7px;">
							<input type="text" class="form-control" placeholder="请输入图书名" />
							<span class="input-group-btn">
					            <button class="btn btn-info btn-search">
					            	<span class="glyphicon glyphicon-search"></span>
					            </button>
							</span>
						</div>
					</div>
				</div>
			</nav>
		</div>
		<!--导航部分 end-->

		<!--最顶端轮播图片 begin-->
		<div id="gcarouse" class="container">
			<!--轮播-->
			<div id="myCarousel" class="carousel slide">
				<!-- 轮播（Carousel）指标 -->
				<ol class="carousel-indicators">
					<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					<li data-target="#myCarousel" data-slide-to="1"></li>
					<li data-target="#myCarousel" data-slide-to="2"></li>
				</ol>
				<!-- 轮播（Carousel）项目 -->
				<div class="carousel-inner">
					<div class="item active">
						<a href="details.html"><img src="images/advert1.jpg" th:src="@{/images/advert1.jpg}" class="pull-left" alt="First slide"></a>

					</div>
					<div class="item">
						<a href="details.html"><img src="images/advert2.jpg" th:src="@{/images/advert2.jpg}" class="pull-left" alt="First slide"></a>

					</div>
					<div class="item">
						<a href="details.html"><img src="images/advert3.jpg" th:src="@{/images/advert3.jpg}" class="pull-left" alt="First slide"></a>

					</div>
				</div>

				<!-- 轮播（Carousel）导航 -->
				<a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
				<a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
			</div>
		</div>
		<!--最顶端轮播图片 end-->
		<!--购物车 begin-->
		<!--外层div-->
		<div class="container">
			<!--左边-->
			<div class="col-md-8 col-sm-12">
				<!--左边-->
				<ol class="breadcrumb">
					<li>
						<a href="#" class="text-success"><span class="glyphicon glyphicon-heart"></span>&nbsp;&nbsp;我的宝贝</a>
					</li>
				</ol>

				<!--购物车表格 begin-->
				<div class="table-responsive" id="imgDiv">
					<table class="table table-hover table-striped" style="vertical-align:middle;">
						<thead>
							<tr>
								<td colspan="8">
									<label class="text-primary">显示条数:</label>
									<select id="cartSzie" class="form-control" style="display: inline" onchange="displaySize(this)">
										<option value="2">2</option>
										<option value="4">4</option>
										<option value="6" selected>6</option>
										<option value="8">8</option>
									</select>
								</td>
							</tr>
							<tr class="text-success success">
								<th><input type="checkbox" id="selectAll" onclick="selectAll(this)"></th>
								<th id="sequence">序号</th>
								<th>图片</th>
								<th>书名</th>
								<th>单价</th>
								<th>数量</th>
								<th>合计</th>
							</tr>
						</thead>
						<tbody id="tby">
							<tr th:each="cart,item:${cartList}">
								<td><input type="checkbox" name="cks" th:value="${cart.id}"></td>
								<td th:text="${cart.bookId}">1005</td>
								<td><img src="images/xizang.jpg" th:src="@{'/images/'+${cart.imgUrl}}"></td>
								<td th:text="${cart.bookName}">西藏</td>
								<td th:text="${cart.newPrice + '元'}">35.0元</td>
								<td>
									<div class='input-group' style='width: 105px;'>
									<span class='input-group-btn'>
									<button class='btn btn-default' type='button' th:onclick="minus([[${cart.id}]],[[${cart.newPrice}]],[[${item.index}]])">-</button>
									</span><input type='text' class='form-control' th:id="${'cartCount'+item.index}" th:value="${cart.count}"><span class='input-group-btn'>
									<button class='btn btn-default' type='button' th:onclick="plus([[${cart.id}]],[[${cart.newPrice}]],[[${item.index}]])">+</button>
									</span>
									</div>
								</td>
								<td th:text="${cart.newPrice * cart.count}" th:id="${'cartPrice'+item.index}">100$</td>
							</tr>
						</tbody>
						<tfoot>
							<tr>
								<td colspan="5"></td>
								<td class="text-success">全部商品总价:</td>
								<td class="text-success" th:text="${session.userCartInfo.totalPrice +'元' }" id="cart_Total">345元</td>
							</tr>
							<tr style="background-color: white;">
								<td>
									<a href="index.html" th:href="@{/book/index}" class="btn btn-info">&lt;&lt;继续购买</a>
								</td>
								<td><button class="btn btn-danger" data-toggle="modal" data-target="#myModal" onclick="del()">删除商品</button></td>
								<td colspan="4"></td>
								<td>
									<a href="javascript:void(0)" th:onclick="confirmOrder()" class="btn btn-warning">结算商品</a>
								</td>
							</tr>
						</tfoot>
					</table>
				</div>
				<!--购物车 end-->

				<!--删除提示模态框 begin-->
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<!--如果没有选中任何一个商品的时候,出现-->
					<div id="first_del" style="display: none;">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h4 class="modal-title text-warning" id="firstModalLabel">抱歉!请您先选择商品!</h4>
								</div>
								<div class="modal-body">请选进行勾选!再执行删除删除!</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
					</div>
					<!--first_del  end-->

					<!--如果没有选中了一个商品的时候,出现-->
					<div id="two_del" style="display: none;">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h4 class="modal-title text-warning" id="twoModalLabel">删除商品,慎重操作!</h4>
								</div>
								<div class="modal-body">此操作一旦进行,数据将不可恢复!</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									<button type="button" class="btn btn-danger" onclick="delRows(this)">确定删除</button>
								</div>
							</div>
							<!-- /.modal-content -->
						</div>
					</div>
					<!--two_del  end-->
				</div>
				<!--删除提示模态框 end-->
			</div>

			<!--右边-->
			<div class="col-md-4 col-sm-3 col-xs-8">
				<ol class="breadcrumb ">
					<li>
						<a href="# " class="text-success "><span class="glyphicon glyphicon-shopping-cart "></span>我的购物车</a>
					</li>
					<li>
						<a href="# " th:text="${session.userCartInfo.num + '个商品'}">3个商品</a>
					</li>
					<li>
						<a href="# " th:text="${'全部商品总价' + session.userCartInfo.totalPrice +'元' }" id="cartTotal">总价100元</a>
					</li>
				</ol>

			<!--猜您喜欢-->
				<div>
					<span class="text-info"><span class="glyphicon glyphicon-heart"></span><span style="font-size: 20px; ">&nbsp;&nbsp;猜您喜欢</span></span>
					<div class="row" id="love">
						<div class="col-sm-12 col-md-12 wow fadeInRight animated">
							<div class="thumbnail">
								<a href="details.html"><img src="images/cikehuakai.jpg " th:src="@{/images/cikehuakai.jpg}" style="height: 200px; " alt="通用的占位符缩略图 "></a>
								<div class="caption ">
									<h3>此刻花开</h3>
								</div>
							</div>
						</div>
						<div class="col-sm-12 col-md-12 wow fadeInRight animated">
							<div class="thumbnail ">
								<a href="details.html"><img src="images/jindumanbu.jpg " th:src="@{/images/jindumanbu.jpg}"  style="height: 200px; " alt="通用的占位符缩略图 "></a>
								<div class="caption ">
									<h3>京都漫步</h3>
								</div>
							</div>
						</div>
						<div class="col-sm-12 col-md-12 wow fadeInRight animated">
							<div class="thumbnail ">
								<a href="details.html"><img src="images/lapulasidemonv.jpg" th:src="@{/images/lapulasidemonv.jpg}"  style="height: 200px; " alt="通用的占位符缩略图 "></a>
								<div class="caption ">
									<h3>拉普拉斯的魔女</h3>
								</div>
							</div>
						</div>
						<div>
							<ul class="pager ">
								<li>
									<a href="#" onclick="pageUp() ">&larr;上一页</a>
									<a href="#" onclick="pageDown() ">下一页 &rarr;</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!--喜欢end-->
			</div>
		</div>

		<div class="container">
			<!--首页底部信息 begin-->
			<div class="container">
				<div class="row">
					<div class="col-md-offset-2 col-md-8">
						<div class="row">
							<div class="col-md-offset-2 col-md-2">
								<img src="images/logo.png" th:src="@{/images/logo.png}">
							</div>
							<div class="col-md-6" style="margin-top: 10px;">
								<div class="row">
									<div class="col-md-offset-2 col-md-10">
										<a href="http://www.soulmatelq.top/">SOM信息科技有限公司&copy;所有</a>
									</div>
								</div>
								<div class="gap"></div>
								<div class="row">
									<div class="col-md-offset-2 col-md-10">
										<span class="text-info">SOM&reg; |&nbsp;</span>
										<span class="text-info"><a href="http://www.soulmatelq.top">SOM博客</a> |&nbsp;</span>
										<span class="text-info">2019－2020 </span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--首页底部信息end-->
		</div>
		<!--end-->

		<!-- 登录模态框（Modal） -->
		<div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="loginModalLabel">
							用户登录
						</h4>
					</div>
					<div class="modal-body">
						<!--登录的form表单-->
						<form id="loginForm" class="form-horizontal" role="form" action="">
							<div class="form-group has-feedback">
								<label  class="col-sm-2 control-label">用户名</label>
								<div class="col-sm-5">

									<input type="text" class="form-control" name="username" placeholder="请输入用户名">
									<span class="glyphicon glyphicon-user form-control-feedback"></span>
								</div>
								<div class="col-sm-3" id="userTip" style="display: none">
									<label class="alert-danger">用户名不存在</label>
								</div>
							</div>
							<div class="form-group has-feedback">
								<label  class="col-sm-2 control-label">密码</label>
								<div class="col-sm-5">
									<input type="password" class="form-control" name="password" placeholder="请输入密码">
									<span class="glyphicon glyphicon-lock form-control-feedback"></span>
								</div>
								<div class="col-sm-3" id="pwdTip" style="display: none">
									<label class="alert-danger">密码不正确</label>
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<div class="checkbox">
										<label>
											<input type="checkbox">请记住我
										</label>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
								<input type="button" class="btn btn-primary" value="登录" th:onclick="|login()|" >
							</div>
						</form>
						<!--form结束-->
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
		</div>
		<!-- 登录modal end/.modal -->

		<!-- 注册模态框（Modal） -->
		<div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="regModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="regModalLabel">
							用户注册
						</h4>
					</div>
					<div class="modal-body">
						<!--注册的form表单-->
						<form id="regForm" action="" class="form-horizontal" role="form">
							<div class="form-group has-feedback">
								<label  class="col-sm-2 control-label">用户名</label>
								<div class="col-sm-5">
									<input type="text" name="username" class="form-control"  required placeholder="小写字母开头,不含中文." th:onblur="|CheckUser(this)|">
									<span class="glyphicon glyphicon-user form-control-feedback"></span>
								</div>
								<div id="msg" class="col-sm-3" style="padding-top: 10px;display: none;">
									<label id="tip" class="alert-danger">用户名不合法</label>
								</div>
							</div>
							<div class="form-group has-feedback">
								<label  class="col-sm-2 control-label">密码</label>
								<div class="col-sm-5">
									<input type="password" name="password"  class="form-control"  placeholder="密码长度6-8位" minlength="6" maxlength="8">
									<span class="glyphicon glyphicon-lock form-control-feedback"></span>
								</div>
								<!--<div class="col-sm-3" style="padding-top: 10px;">
									<label class="alert-danger">密码不正确</label>
								</div>-->
							</div>
							<div class="form-group has-feedback">
								<label class="col-sm-2 control-label">确认密码</label>
								<div class="col-sm-5">
									<input type="password" class="form-control"  minlength="6" maxlength="8" placeholder="和密码保持一致">
									<span class="glyphicon glyphicon-lock form-control-feedback"></span>
								</div>
							</div>

							<div class="form-group has-feedback">
								<label class="col-sm-2 control-label">邮箱</label>
								<div class="col-sm-5">
									<input type="email" name="email"  class="form-control"  placeholder="合法邮箱格式">
									<span class="glyphicon glyphicon-envelope form-control-feedback"></span>
								</div>
							</div>

							<div class="form-group has-feedback">
								<label class="col-sm-2 control-label">电话</label>
								<div class="col-sm-5">
									<input type="tel" name="phone"  class="form-control"  placeholder="合法手机格式">
									<span class="glyphicon glyphicon-earphone form-control-feedback"></span>
								</div>
							</div>

							<div class="form-group has-feedback">
								<label class="col-sm-2 control-label">公司</label>
								<div class="col-sm-5">
									<input type="text" name="company"  class="form-control"  placeholder="请输入公司地址">
									<span class="glyphicon glyphicon-book form-control-feedback"></span>
								</div>
							</div>

							<!--<div class="form-group has-feedback">-->
							<!--<label class="col-sm-2 control-label">地址</label>-->
							<!--<div class="col-sm-5">-->
							<!--<input type="text" class="form-control"  placeholder="请输入收货">-->
							<!--<span class="glyphicon glyphicon-book form-control-feedback"></span>-->
							<!--</div>-->
							<!--</div>-->

							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
								<input type="button" class="btn btn-primary" value="注册" th:onclick="|register()|">
							</div>
						</form>
						<!--form结束-->
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
		</div>
		<!-- 注册模态框（Modal） end -->

		<!--引入js文件-->
		<script src="dist/js/jquery.min.js" th:src="@{/dist/js/jquery.min.js}"></script>
		<script src="js/wow.js" th:src="@{/js/wow.js}"></script>
		<script src="js/carousel.js" th:src="@{/js/carousel.js}" type="text/javascript"></script>
		<script src="dist/js/bootstrap.min.js" th:src="@{/dist/js/bootstrap.min.js}"></script>
		<script src="js/details.js" th:src="@{/js/details.js}" type="text/javascript" charset="utf-8"></script>
		<script src="js/cart.js" th:src="@{/js/cart.js}" type="text/javascript" charset="utf-8"></script>
		<!--定义全局路径-->
		<script th:inline="javascript">
			var contextPath = [[${#request.getContextPath()}]];
		</script>
		<!--用户登录注册-->
		<script th:src="@{/js/userLoginReg.js}"></script>
		<script type="text/javascript">
			if(!(/msie [6|7|8|9]/i.test(navigator.userAgent))) {
				new WOW().init();
			};

			//修改购物车商品的数量
			//删减操作
			function minus(cartId,price,index) {
				//购物车数量减一
				//alert($("#cartCount"+index).val());
				var count = parseInt($("#cartCount"+index).val());
				var _price = parseFloat(price);
				if(1 != count){
					$("#cartCount"+index).val(count - 1);
					$("#cartPrice"+index).html((count - 1) * _price);
					updateCart(cartId,count - 1);
				}
			}
			//增加操作
			function plus(cartId,price,index) {
				//购物车数量加一
				//alert($("#cartCount"+index).val());
				var count = parseInt($("#cartCount"+index).val());
				var _price = parseFloat(price);
				$("#cartCount"+index).val(count + 1);
				$("#cartPrice"+index).html((count + 1) * _price);
				updateCart(cartId,count + 1);
			}

			//修改后台的购物车数量的数据
			function updateCart(cartId,count) {
				$.ajax({
					url: contextPath + "/cart/update",
					data:{"id":cartId,"count":count},
					method:"post",
					success:function(data){
						// alert(data);
						$("#cartTotal").html('全部商品总价'+ data + '元');
						$("#cart_Total").html(data + '元');

					}
				})
			}

			//提交订单
			function confirmOrder() {
				//判断是否选择了商品
				var count = 0;
				//获取所有的checkbox
				var cks = document.getElementsByName("cks");
				//存储购物车记录的id
				var ids = '';

				//遍历
				for(var i = 0; i < cks.length; i++) {
					if(cks[i].checked) {
						count++;
						ids += cks[i].value + ",";
					}
				}
				if(count == 0) {
					alert("请选择图书!");
				}else{
					window.location.href = contextPath + '/order/confirm?ids=' + ids ;
				}
			}
		</script>

	</body>

</html>